<VirtualHost *:80>
    DocumentRoot /var/www/html/public

    <Directory /var/www/html/public>
        AllowOverride All
        Require all granted

        RewriteEngine On

        # /api/* va a PHP
        RewriteRule ^api(/.*)?$ index.php [QSA,L]

        # /go-api/* va a Go
        RewriteRule ^go-api/(.*) http://go-api:4000/$1 [P,L]

        # /vue va a Vue frontend
        RewriteCond %{REQUEST_URI} ^/vue
        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteRule ^ /vue/index.html [L]

        # /svelte va a Svelte frontend
        RewriteCond %{REQUEST_URI} ^/svelte
        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteRule ^ /svelte/index.html [L]
    </Directory>

    ErrorLog ${APACHE_LOG_DIR}/error.log
    CustomLog ${APACHE_LOG_DIR}/access.log combined

    # Activamos proxy
    ProxyPreserveHost On
    ProxyPass /go-api/ http://go-api:4000/
    ProxyPassReverse /go-api/ http://go-api:4000/
</VirtualHost>
